{% extends "main.html" %}
{% block content %}
    <div class="borrowings-page-admin">
        {% if user_type == "admin" %}
            <form method="GET">
                <button type="submit">חפש/י</button>
                <input type="text" id="identity_num" name="identity_num">
                <label for="identity_num">חיפוש לפי ת.ז</label>
            </form>
        {% endif %}
        <table>
            <caption>
                {% if user_type == "admin" %}
                    {{category}} מידע על השאלות של סטודנטים/מרצים
                    {% if category %} של קטגורית {% endif %}
                {% else %}
                    השאלות שלי
                {% endif %}
            </caption>
            <colgroup>
                <col span="8">
            </colgroup>
            <thead>
                {% if user_type == "admin" %}
                    <tr>
                        <th>סיום השאלה</th>
                        <th>בקשת הארכה</th>
                        <th>תאריך החזרה</th>
                        <th>תאריך השאלה</th>
                        <th>תפקיד</th>
                        <th>מייל</th>
                        <th>מס' טלפון</th>
                        <th>שם הפריט</th>
                        <th>מק''ט הפריט</th>
                        <th>שם משפחה</th>
                        <th>שם פרטי</th>
                        <th>ת.ז</th>
                    </tr>
                {% else %}
                    <tr>
                        <th>בקשת הארכה</th>
                        <th>תאריך החזרה</th>
                        <th>תאריך השאלה</th>
                        <th>שם הפריט</th>
                        <th>מק''ט הפריט</th>
                    </tr>
                {% endif %}
            </thead>
            <tbody>
                {% if user_type == "admin" %}
                    {% for borrowing in borrowings %}
                        <tr style="background-color: {% if borrowing.extension_requested %} rgb(255, 171, 0) {% elif now > borrowing.date_to_return %} rgb(254, 100, 100){% endif %}">
                            <td>
                                <div class="prod-buttons">
                                    <a href="{% url 'finish_borrowing' borrowing.id %}"
                                       class="edit-btn">לסיים</a>
                                </div>
                            </td>
                            <td>
                                {% if borrowing.extension_requested %}
                                    <div class="prod-buttons">
                                        <a href="{% url 'borrowing_extension' borrowing.id %}"
                                           class="edit-btn">לצפות</a>
                                    </div>
                                {% endif %}
                            </td>
                            <td>{{ borrowing.date_to_return|date:"SHORT_DATETIME_FORMAT" }}</td>
                            <td>{{ borrowing.borrowed_at|date:"SHORT_DATETIME_FORMAT" }}</td>
                            <td>{{ borrowing.user.role }}</td>
                            <td>{{ borrowing.user.email }}</td>
                            <td>{{ borrowing.user.mobile_num }}</td>
                            <td>{{ borrowing.product.name }}</td>
                            <td>{{ borrowing.product.stock_num }}</td>
                            <td>{{ borrowing.user.last_name }}</td>
                            <td>{{ borrowing.user.first_name }}</td>
                            <td>{{ borrowing.user.identity_num }}</td>
                        </tr>
                    {% endfor %}
                {% else %}
                    {% for borrowing in borrowings %}
                        <tr style="background-color: {% if borrowing.extension_requested %} rgb(255, 171, 0) {% elif now > borrowing.date_to_return %} rgb(254, 100, 100){% endif %}">
                            <td>
                                {% if not borrowing.extension_requested %}
                                    <div class="prod-buttons">
                                        <a href="{% url 'add_borrowing_extension' borrowing.id %}"
                                           class="edit-btn">בקשה להארכה</a>
                                    </div>
                                {% else %}
                                    בקשת הארכה ל-{{ borrowing.additional_days }}
                                    {% if borrowing.additional_days > 1 %}
                                        ימים
                                    {% else %}
                                        יום
                                    {% endif %}
                                {% endif %}
                            </td>
                            <td>{{ borrowing.date_to_return|date:"SHORT_DATETIME_FORMAT" }}</td>
                            <td>{{ borrowing.borrowed_at|date:"SHORT_DATETIME_FORMAT" }}</td>
                            <td>{{ borrowing.product.name }}</td>
                            <td>{{ borrowing.product.stock_num }}</td>
                        </tr>
                    {% endfor %}
                {% endif %}
            </tbody>
        </table>
    </div>
{% endblock content %}
